{{template "base" .}}

{{define "title"}}Home - Hivemind{{end}}

{{define "content"}}
{{if .User}}
    {{/* Logged in view: Recent Activity Feed */}}
    <div class="space-y-6">
        <div class="mb-6">
            <h1 class="text-3xl font-bold font-heading text-neon-cyan mb-2 text-left">
                [ RECENT ACTIVITY ]
            </h1>
            <p class="text-gray-400">
                Recently updated notes (private to you), quotes, and wiki pages.
            </p>
        </div>

        {{if .RecentActivity}}
        <div class="border-2 border-hive-metal rounded-lg overflow-hidden">
            <table class="w-full text-sm">
                <thead class="bg-hive-surface border-b-2 border-hive-metal">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-mono text-gray-400 uppercase tracking-wider">Type</th>
                        <th class="px-4 py-3 text-left text-xs font-mono text-gray-400 uppercase tracking-wider">Title</th>
                        <th class="px-4 py-3 text-left text-xs font-mono text-gray-400 uppercase tracking-wider">Preview</th>
                        <th class="px-4 py-3 text-left text-xs font-mono text-gray-400 uppercase tracking-wider">Author</th>
                        <th class="px-4 py-3 text-left text-xs font-mono text-gray-400 uppercase tracking-wider">Location</th>
                        <th class="px-4 py-3 text-left text-xs font-mono text-gray-400 uppercase tracking-wider">Tags</th>
                        <th class="px-4 py-3 text-left text-xs font-mono text-gray-400 uppercase tracking-wider">Refs</th>
                        <th class="px-4 py-3 text-left text-xs font-mono text-gray-400 uppercase tracking-wider">Date</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-hive-metal">
                    {{range .RecentActivity}}
                    {{$url := ""}}
                    {{if eq .Type "wiki"}}
                        {{$url = printf "/wiki?slug=%s&guild_id=%s" .Slug .GuildID}}
                    {{else if eq .Type "note"}}
                        {{$url = printf "/note?id=%s" .ID}}
                    {{else if eq .Type "quote"}}
                        {{$url = printf "/quote?id=%s" .ID}}
                    {{end}}
                    <tr class="hover:bg-hive-surface transition-colors cursor-pointer" onclick="window.location='{{$url}}'">
                        <td class="px-4 py-3 whitespace-nowrap">
                            {{if eq .Type "note"}}
                            <span class="px-2 py-1 bg-neon-cyan bg-opacity-20 text-neon-cyan text-xs font-mono rounded border border-neon-cyan">
                                NOTE
                            </span>
                            {{else if eq .Type "quote"}}
                            <span class="px-2 py-1 bg-neon-magenta bg-opacity-20 text-neon-magenta text-xs font-mono rounded border border-neon-magenta">
                                QUOTE
                            </span>
                            {{else if eq .Type "wiki"}}
                            <span class="px-2 py-1 bg-neon-green bg-opacity-20 text-neon-green text-xs font-mono rounded border border-neon-green">
                                WIKI
                            </span>
                            {{end}}
                        </td>
                        <td class="px-4 py-3">
                            {{if .Title}}
                            <span class="font-semibold text-gray-100">
                                {{.Title}}
                            </span>
                            {{else}}
                            <span class="text-gray-400 italic">
                                {{ if ne .Type "quote"}} (no title) {{ end }}
                            </span>
                            {{end}}
                        </td>
                        <td class="px-4 py-3 max-w-md">
                            <div class="text-gray-400 truncate">
                                {{.Preview}}
                            </div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-300">
                            {{if .Author}}{{.Author}}{{else}}-{{end}}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-gray-400 text-xs">
                            {{if .GuildName}}
                                {{.GuildName}}
                                {{if .ChannelName}}
                                    <span class="text-gray-500">/ {{.ChannelName}}</span>
                                {{end}}
                            {{else}}
                                -
                            {{end}}
                        </td>
                        <td class="px-4 py-3">
                            {{if .Tags}}
                            <div class="flex flex-wrap gap-1">
                                {{range .Tags}}
                                <a href="/{{$.Type}}s?tag={{.}}" class="text-xs text-gray-400 hover:text-neon-magenta transition-colors">
                                    #{{.}}
                                </a>
                                {{end}}
                            </div>
                            {{else}}
                            <span class="text-gray-500">-</span>
                            {{end}}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-center">
                            {{if eq .Type "wiki"}}
                                {{if gt .ReferenceCount 0}}
                                <span class="text-neon-green font-mono text-sm">{{.ReferenceCount}}</span>
                                {{else}}
                                <span class="text-gray-500">-</span>
                                {{end}}
                            {{else}}
                            <span class="text-gray-600">-</span>
                            {{end}}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-xs text-gray-500">
                            {{.Timestamp.Format "Jan 2"}}
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>

        {{else}}
        <!-- Empty state -->
        <div class="text-center py-12">
            <div class="text-6xl mb-4">ðŸ“­</div>
            <h2 class="text-2xl font-bold text-gray-300 mb-2">No Activity Yet</h2>
            <p class="text-gray-400 mb-6">
                Start creating notes (private to you), saving quotes, or contributing to wiki pages!
            </p>
            <div class="flex justify-center gap-4">
                <a href="/notes" class="px-4 py-2 bg-neon-cyan text-hive-bg font-mono rounded hover:bg-opacity-90 transition-colors">
                    [ CREATE NOTE ]
                </a>
            </div>
        </div>
        {{end}}
    </div>

{{else}}
    {{/* Not logged in view */}}
    <div class="max-w-md mx-auto text-center py-12">
        {{/* Logo */}}
        <div class="mb-8">
            <img src="{{assetURL "img/hivemind-brain-note-512.png"}}" alt="Hivemind" class="w-32 h-32 mx-auto shadow-neon-magenta rounded-lg">
        </div>
        
        {{/* Welcome text */}}
        <h1 class="text-5xl font-bold font-heading text-glitch mb-4">
            WELCOME TO<br>HIVEMIND
        </h1>
        <p class="text-gray-400 mb-8 text-lg">
            Because finding stuff in Discord threads is hard
        </p>
        
        {{/* Login buttons */}}
        {{if .Providers}}
        <div class="space-y-3">
            {{range .Providers}}
            <a href="/login?provider={{.Name}}" 
               class="block w-full px-6 py-3 bg-hive-surface border-2 border-neon-cyan hover:bg-neon-cyan text-neon-cyan hover:text-hive-bg font-medium font-mono rounded-lg transition-all duration-200 shadow-neon-cyan hover:shadow-neon-cyan">
                [ SIGN IN WITH {{.Name | title}} ]
            </a>
            {{end}}
        </div>
        {{else}}
        <a href="/login" 
           class="inline-block px-6 py-3 bg-hive-surface border-2 border-neon-cyan hover:bg-neon-cyan text-neon-cyan hover:text-hive-bg font-medium font-mono rounded-lg transition-all duration-200 shadow-neon-cyan hover:shadow-neon-cyan">
            [ SIGN IN ]
        </a>
        {{end}}
    </div>

{{end}}
{{end}}
