{{template "base" .}}

{{define "title"}}Home - Hivemind{{end}}

{{define "content"}}
{{if .User}}
    {{/* Logged in view: Recent Activity Feed */}}
    <div class="space-y-6">
        <div class="mb-6">
            <h1 class="text-3xl font-bold font-heading text-neon-cyan mb-2 text-left">
                [ RECENT ACTIVITY ]
            </h1>
            <p class="text-gray-400">
                Recently updated notes (private to you), quotes, and wiki pages.
            </p>
        </div>

        {{if .RecentActivity}}
        <div class="space-y-3">
            {{range .RecentActivity}}
            {{$url := ""}}
            {{if eq .Type "wiki"}}
                {{$url = printf "/wiki?slug=%s&guild_id=%s" .Slug .GuildID}}
            {{else if eq .Type "note"}}
                {{$url = printf "/note?id=%s" .ID}}
            {{else if eq .Type "quote"}}
                {{$url = printf "/quote?id=%s" .ID}}
            {{end}}
            
            <a href="{{$url}}" class="block border-2 border-gray-500 rounded-lg p-4 bg-hive-surface {{if eq .Type "wiki"}}hover:border-neon-green hover:shadow-neon-green{{else if eq .Type "quote"}}hover:border-neon-magenta hover:shadow-neon-magenta{{else}}hover:border-neon-cyan hover:shadow-neon-cyan{{end}} hover:bg-[#252936] transition-all cursor-pointer group">
                {{/* Mobile layout: Stacked */}}
                <div class="flex flex-col gap-3 lg:hidden">
                    {{/* Header: Type badge and Date */}}
                    <div class="flex items-center justify-between">
                        <div>
                            {{if eq .Type "note"}}
                            <span class="inline-block px-2 py-1 bg-neon-cyan bg-opacity-20 text-neon-cyan text-xs font-mono rounded border border-neon-cyan">
                                NOTE
                            </span>
                            {{else if eq .Type "quote"}}
                            <span class="inline-block px-2 py-1 bg-neon-magenta bg-opacity-20 text-neon-magenta text-xs font-mono rounded border border-neon-magenta">
                                QUOTE
                            </span>
                            {{else if eq .Type "wiki"}}
                            <span class="inline-block px-2 py-1 bg-neon-green bg-opacity-20 text-neon-green text-xs font-mono rounded border border-neon-green">
                                WIKI
                            </span>
                            {{end}}
                        </div>
                        <time class="text-xs text-gray-500 font-mono">
                            {{.Timestamp.Format "Jan 2, 2006"}}
                        </time>
                    </div>

                    {{/* Main Content: Title and Preview */}}
                    <div>
                        {{if .Title}}
                        <h3 class="font-semibold text-gray-100 text-base mb-1 group-hover:text-neon-cyan transition-colors line-clamp-2">
                            {{.Title}}
                        </h3>
                        {{else}}
                        <h3 class="text-gray-400 italic text-sm mb-1">
                            {{ if ne .Type "quote"}}(no title){{ end }}
                        </h3>
                        {{end}}
                        
                        {{if .Preview}}
                        <p class="text-gray-300 text-sm line-clamp-2 leading-relaxed">
                            {{.Preview}}
                        </p>
                        {{end}}
                    </div>

                    {{/* Footer: Metadata */}}
                    <div class="space-y-2 text-sm">
                        {{/* Author and Location */}}
                        <div class="flex items-center gap-3 text-gray-300 flex-wrap">
                            {{if .Author}}
                            <div class="flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                                <span class="text-gray-300">{{.Author}}</span>
                            </div>
                            {{end}}
                            
                            {{if .GuildName}}
                            <div class="flex items-center gap-1 text-xs">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                <span>{{.GuildName}}</span>
                                {{if .ChannelName}}
                                    <span class="text-gray-500">/ {{.ChannelName}}</span>
                                {{end}}
                            </div>
                            {{end}}
                        </div>

                        {{/* Tags and References */}}
                        <div class="flex items-center justify-between">
                            <div class="flex flex-wrap gap-1">
                                {{if .Tags}}
                                    {{$tagCount := len .Tags}}
                                    {{range $index, $tag := .Tags}}
                                        {{if lt $index 3}}
                                        <span class="text-xs text-gray-400 hover:text-neon-magenta transition-colors">
                                            #{{$tag}}
                                        </span>
                                        {{end}}
                                    {{end}}
                                    {{if gt $tagCount 3}}
                                    <span class="text-xs text-gray-500">
                                        +{{sub $tagCount 3}} more
                                    </span>
                                    {{end}}
                                {{end}}
                            </div>
                            
                            {{if eq .Type "wiki"}}
                                {{if gt .ReferenceCount 0}}
                                <div class="flex items-center gap-1 text-neon-green text-xs font-mono">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                                    </svg>
                                    <span>{{.ReferenceCount}}</span>
                                </div>
                                {{end}}
                            {{end}}
                        </div>
                    </div>
                </div>

                {{/* Desktop layout: Horizontal row with consistent height */}}
                <div class="hidden lg:flex lg:items-center lg:gap-4">
                    {{/* Type badge - fixed width, always leftmost */}}
                    <div class="flex-shrink-0 w-20">
                        {{if eq .Type "note"}}
                        <span class="inline-block px-2 py-1 bg-neon-cyan bg-opacity-20 text-neon-cyan text-xs font-mono rounded border border-neon-cyan">
                            NOTE
                        </span>
                        {{else if eq .Type "quote"}}
                        <span class="inline-block px-2 py-1 bg-neon-magenta bg-opacity-20 text-neon-magenta text-xs font-mono rounded border border-neon-magenta">
                            QUOTE
                        </span>
                        {{else if eq .Type "wiki"}}
                        <span class="inline-block px-2 py-1 bg-neon-green bg-opacity-20 text-neon-green text-xs font-mono rounded border border-neon-green">
                            WIKI
                        </span>
                        {{end}}
                    </div>

                    {{/* Title and Preview - flexible width */}}
                    <div class="flex-1 min-w-0">
                        {{if .Title}}
                        <h3 class="font-semibold text-gray-100 text-sm mb-0.5 group-hover:text-neon-cyan transition-colors truncate">
                            {{.Title}}
                        </h3>
                        {{else}}
                        <h3 class="text-gray-400 italic text-sm">
                            {{ if ne .Type "quote"}}(no title){{ end }}
                        </h3>
                        {{end}}
                        {{if .Preview}}
                        <p class="text-gray-300 text-xs truncate">
                            {{.Preview}}
                        </p>
                        {{end}}
                    </div>

                    {{/* Author - fixed width */}}
                    <div class="flex-shrink-0 w-32 flex items-center gap-1 text-gray-300 text-sm">
                        {{if .Author}}
                        <svg class="w-3.5 h-3.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-gray-300 truncate">{{.Author}}</span>
                        {{else}}
                        <span class="text-gray-500">-</span>
                        {{end}}
                    </div>

                    {{/* Location - fixed width */}}
                    <div class="flex-shrink-0 w-40 flex items-center gap-1 text-gray-300 text-xs">
                        {{if .GuildName}}
                        <svg class="w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <span class="truncate">{{.GuildName}}{{if .ChannelName}}<span class="text-gray-500"> / {{.ChannelName}}</span>{{end}}</span>
                        {{else}}
                        <span class="text-gray-500">-</span>
                        {{end}}
                    </div>

                    {{/* Tags - fixed width */}}
                    <div class="flex-shrink-0 w-32 flex flex-wrap gap-1 overflow-hidden">
                        {{if .Tags}}
                            {{$tagCount := len .Tags}}
                            {{range $index, $tag := .Tags}}
                                {{if lt $index 3}}
                                <span class="text-xs text-gray-400 hover:text-neon-magenta transition-colors whitespace-nowrap">
                                    #{{$tag}}
                                </span>
                                {{end}}
                            {{end}}
                            {{if gt $tagCount 3}}
                            <span class="text-xs text-gray-500 whitespace-nowrap">
                                +{{sub $tagCount 3}}
                            </span>
                            {{end}}
                        {{else}}
                        <span class="text-gray-500 text-xs">-</span>
                        {{end}}
                    </div>

                    {{/* References - fixed width */}}
                    <div class="flex-shrink-0 w-16 text-center">
                        {{if eq .Type "wiki"}}
                            {{if gt .ReferenceCount 0}}
                            <div class="flex items-center justify-center gap-1 text-neon-green text-xs font-mono">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                                </svg>
                                <span>{{.ReferenceCount}}</span>
                            </div>
                            {{else}}
                            <span class="text-gray-500 text-xs">-</span>
                            {{end}}
                        {{else}}
                        <span class="text-gray-600 text-xs">-</span>
                        {{end}}
                    </div>

                    {{/* Date - fixed width */}}
                    <div class="flex-shrink-0 w-24 text-right">
                        <time class="text-xs text-gray-500 font-mono">
                            {{.Timestamp.Format "Jan 2, 2006"}}
                        </time>
                    </div>
                </div>
            </a>
            {{end}}
        </div>

        {{else}}
        <!-- Empty state -->
        <div class="text-center py-12">
            <div class="text-6xl mb-4">ðŸ“­</div>
            <h2 class="text-2xl font-bold text-gray-300 mb-2">No Activity Yet</h2>
            <p class="text-gray-400 mb-6">
                Start creating notes (private to you), saving quotes, or contributing to wiki pages!
            </p>
            <div class="flex justify-center gap-4">
                <a href="/notes" class="px-4 py-2 bg-neon-cyan text-hive-bg font-mono rounded hover:bg-opacity-90 transition-colors">
                    [ CREATE NOTE ]
                </a>
            </div>
        </div>
        {{end}}
    </div>

{{else}}
    {{/* Not logged in view */}}
    <div class="max-w-md mx-auto text-center py-12">
        {{/* Logo */}}
        <div class="mb-8">
            <img src="{{assetURL "img/hivemind-brain-note-512.png"}}" alt="Hivemind" class="w-32 h-32 mx-auto shadow-neon-magenta rounded-lg">
        </div>
        
        {{/* Welcome text */}}
        <h1 class="text-5xl font-bold font-heading text-glitch mb-4">
            WELCOME TO<br>HIVEMIND
        </h1>
        <p class="text-gray-400 mb-8 text-lg">
            Because finding stuff in Discord threads is hard
        </p>
        
        {{/* Login buttons */}}
        {{if .Providers}}
        <div class="space-y-3">
            {{range .Providers}}
            <a href="/login?provider={{.Name}}" 
               class="block w-full px-6 py-3 bg-hive-surface border-2 border-neon-cyan hover:bg-neon-cyan text-neon-cyan hover:text-hive-bg font-medium font-mono rounded-lg transition-all duration-200 shadow-neon-cyan hover:shadow-neon-cyan">
                [ SIGN IN WITH {{.Name | title}} ]
            </a>
            {{end}}
        </div>
        {{else}}
        <a href="/login" 
           class="inline-block px-6 py-3 bg-hive-surface border-2 border-neon-cyan hover:bg-neon-cyan text-neon-cyan hover:text-hive-bg font-medium font-mono rounded-lg transition-all duration-200 shadow-neon-cyan hover:shadow-neon-cyan">
            [ SIGN IN ]
        </a>
        {{end}}
    </div>

{{end}}
{{end}}
