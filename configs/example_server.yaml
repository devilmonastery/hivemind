# Example Server Configuration
# This file shows all available configuration options for the gRPC server.
# Copy this file and customize it for your deployment.

# Environment: local, dev, or prod
environment: "local"

# Vault secrets path (only used when use_vault_secrets is true)
vault_path: "/mnt/secrets"

# Database configuration
database:
  # PostgreSQL configuration
  postgres:
    # Database server hostname
    host: "localhost"
    # Database server port
    port: 5432
    # Database name
    database: "hivemind"
    # Database user
    user: "hivemind"
    # Database password (can also be set via environment variable)
    password: "your_password_here"
    # SSL mode: "disable", "require", "verify-ca", "verify-full"
    sslmode: "disable"

# gRPC server configuration
grpc:
  # Host to bind to (use "0.0.0.0" to listen on all interfaces)
  host: "127.0.0.1"
  # Port to listen on
  port: 9091

# Logging configuration
logging:
  # Log level: "debug", "info", "warn", "error"
  level: "info"
  # Log format: "json" or "text"
  format: "json"
  # Output: "stdout", "stderr", or file path
  output: "stdout"

# Authentication configuration
auth:
  # JWT token configuration
  jwt:
    # Secret key for signing JWT tokens
    # Generate with: openssl rand -base64 32
    # IMPORTANT: Keep this secret! Anyone with this key can forge tokens.
    signing_key: "your-secret-key-here-change-me"
    
    # Token lifetime (duration string)
    # Examples: "15m", "1h", "24h", "168h" (7 days)
    # Recommended: 1h for production, 10m for development (to test refresh)
    lifetime: "1h"
  
  # Encryption key for OAuth refresh tokens (REQUIRED)
  # Generate with: openssl rand -base64 32
  # Must be exactly 32 bytes (256 bits) when base64-decoded
  # IMPORTANT: Keep this secret! Used to encrypt OAuth refresh tokens in database.
  # Use different keys for dev/staging/prod environments.
  encryption_key: "your-encryption-key-here-change-me"
  
  # Development bot token (DEVELOPMENT ONLY)
  # ⚠️  WARNING: This triggers a security warning and should NOT be used in production! ⚠️
  # 
  # WHY THIS WARNING EXISTS:
  # - Config-based tokens are less secure (visible in config files, logs, version control)
  # - They can't be easily rotated without restarting the server
  # - They don't get audited in the database like proper service tokens
  # 
  # FOR LOCAL DEVELOPMENT:
  # - It's OK to use this for convenience during development
  # - The warning is just a reminder not to use this approach in production
  # 
  # FOR PRODUCTION:
  # - Remove or comment out this dev_bot_token line
  # - Generate a proper service token using:
  #     ./bin/hivemind-server token create-service --name "discord-bot" --role bot --config configs/prod-server.yaml
  #   
  #   In Docker (config mounted at /config/server.yaml):
  #     docker exec -it <container-name> ./hivemind-server token create-service --name "discord-bot" --role bot --config /config/server.yaml
  #   
  #   In Kubernetes (config from ConfigMap/Secret):
  #     kubectl exec -it deployment/hivemind-server -- ./hivemind-server token create-service --name "discord-bot" --role bot --config /config/server.yaml
  #   
  # - Store the generated JWT token in your bot's config (service_token field)
  # - Service tokens are stored in the database and can be revoked if compromised
  # 
  # dev_bot_token: "dev-only-token-change-me"
  
  # OAuth/OIDC provider configuration
  providers:
    # Discord OAuth
    - name: discord
      type: oidc
      issuer: "https://discord.com"
      client_id: "your-discord-application-id"  # Same as Discord Client ID
      client_secret: "your-discord-client-secret"
      auto_provision: true
      # Optional: restrict to specific users
      # allowed_users:
      #   - "user@example.com"



